<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gr√°ficos en Tiempo Real - Sistema Modular v2.0</title>
  <link rel="stylesheet" href="../../../styles.css"> <!-- Enlace al archivo CSS -->
</head>
<body>
  <img id="logo" src="" alt="Logo">
  
  <!-- Elementos gr√°ficos principales -->
  <div id="grafico-invitado-rol" class="animated-element" style="display: none;">
    <h1 id="invitado">INVITADO</h1>
    <h2 id="rol">ROL</h2>
  </div>
  
  <div id="grafico-tema" class="animated-element" style="display: none;">
    <h1 id="tema">.</h1>
  </div>

  <div id="grafico-publicidad" class="animated-element" style="display: none;">
    <img id="publicidad-img" src="" alt="Publicidad">
  </div>

  <div id="status" class="animated-element">
    <!-- Estado de conexi√≥n y sistema -->
  </div>

  <!-- üÜï PANEL DE DEBUG MEJORADO PARA SISTEMA MODULAR -->
  <div id="debug-panel" class="debug-panel" style="display: none;">
    <div class="debug-header">
      <h4>üîß Sistema Modular v2.0</h4>
      <button id="toggle-debug" onclick="toggleDebugPanel()">‚ùå</button>
    </div>
    <div class="debug-content">
      <div class="debug-section">
        <h5>üìä Estado de la App:</h5>
        <div id="debug-app-status">Cargando...</div>
      </div>
      <div class="debug-section">
        <h5>üì¶ M√≥dulos Cargados:</h5>
        <div id="debug-modules">Cargando...</div>
      </div>
      <div class="debug-section">
        <h5>‚è∞ Scheduler Global:</h5>
        <div id="debug-scheduler">Desactivado</div>
      </div>
      <div class="debug-section">
        <h5>üî• Firebase:</h5>
        <div id="debug-firebase">Desconectado</div>
      </div>
      <div class="debug-section">
        <h5>üñºÔ∏è Estado de Logos:</h5>
        <div id="debug-logos">Cargando...</div>
      </div>
    </div>
    <div class="debug-controls">
      <button onclick="testModularSystem()">üß™ Test M√≥dulos</button>
      <button onclick="showAppStatus()">üìä Estado App</button>
      <button onclick="forceElementsTest()">üëÅÔ∏è Test Elementos</button>
      <button onclick="clearConsole()">üóëÔ∏è Limpiar Console</button>
    </div>
  </div>

  <!-- üöÄ SISTEMA MODULAR v2.0 - PUNTO DE ENTRADA PRINCIPAL -->
  <script type="module" src="main.js"></script>
  
  <!-- üîß FUNCIONES DE DEBUG PARA SISTEMA MODULAR -->
  <script>
    let debugVisible = false;
    
    // ===== FUNCIONES DE PANEL DEBUG =====
    
    function showDebugPanel() {
      const panel = document.getElementById('debug-panel');
      if (panel) {
        panel.style.display = 'block';
        debugVisible = true;
        updateDebugInfo();
      }
    }
    
    function toggleDebugPanel() {
      const panel = document.getElementById('debug-panel');
      if (panel) {
        if (panel.style.display === 'none') {
          showDebugPanel();
        } else {
          panel.style.display = 'none';
          debugVisible = false;
        }
      }
    }
    
    // ===== FUNCIONES DE DEBUG PARA SISTEMA MODULAR =====
    
    function testModularSystem() {
      console.log('üß™ TESTING SISTEMA MODULAR...');
      
      if (window.StreamGraphicsApp) {
        console.log('‚úÖ StreamGraphicsApp disponible');
        console.log('Estado:', window.StreamGraphicsApp.getStatus());
      } else {
        console.error('‚ùå StreamGraphicsApp no disponible');
      }
      
      if (window.StreamDebug) {
        console.log('‚úÖ StreamDebug disponible');
        window.StreamDebug.app && console.log('App:', window.StreamDebug.app.isInitialized);
      } else {
        console.log('‚ö†Ô∏è StreamDebug no disponible (normal si no est√° en modo debug)');
      }
      
      updateDebugInfo();
    }
    
    function showAppStatus() {
      console.log('üìä ESTADO COMPLETO DE LA APLICACI√ìN:');
      
      if (window.StreamGraphicsApp) {
        const status = window.StreamGraphicsApp.getStatus();
        console.table(status.modules);
        console.log('Scheduler:', status.scheduler);
        console.log('Firebase:', status.firebase);
      } else {
        console.error('‚ùå Aplicaci√≥n no inicializada');
      }
    }
    
    function forceElementsTest() {
      console.log('üëÅÔ∏è TESTING ELEMENTOS VISUALES...');
      
      // Test usando StreamDebug si est√° disponible
      if (window.StreamDebug && window.StreamDebug.utils) {
        console.log('üöÄ Usando StreamDebug para testing...');
        
        // Test invitado
        setTimeout(() => {
          console.log('üì∫ Mostrando invitado...');
          if (window.StreamDebug.utils.lowerThirds) {
            window.StreamDebug.utils.lowerThirds.show('invitado', {
              invitado: 'TEST INVITADO',
              rol: 'TEST ROL'
            });
          }
        }, 1000);
        
        // Test tema
        setTimeout(() => {
          console.log('üìã Mostrando tema...');
          if (window.StreamDebug.utils.lowerThirds) {
            window.StreamDebug.utils.lowerThirds.show('tema', {
              tema: 'TEST TEMA'
            });
          }
        }, 3000);
        
        // Test logo
        setTimeout(() => {
          console.log('üñºÔ∏è Mostrando logo...');
          if (window.StreamDebug.utils.logo) {
            window.StreamDebug.utils.logo.show();
          }
        }, 5000);
        
      } else {
        console.log('‚ö†Ô∏è StreamDebug no disponible - usando m√©todo b√°sico...');
        
        // Fallback usando StreamGraphicsApp directamente
        if (window.StreamGraphicsApp && window.StreamGraphicsApp.modules) {
          const modules = window.StreamGraphicsApp.modules;
          
          if (modules.lowerThirds) {
            modules.lowerThirds.showInvitado({
              invitado: 'TEST B√ÅSICO INVITADO',
              rol: 'TEST B√ÅSICO ROL'
            });
          }
        }
      }
    }
    
    function clearConsole() {
      console.clear();
      console.log('üóëÔ∏è Console limpiada');
      console.log('üí° Sistema Modular v2.0 ejecut√°ndose...');
    }
    
    // ===== ACTUALIZACI√ìN AUTOM√ÅTICA DE DEBUG INFO =====
    
    function updateDebugInfo() {
      if (!debugVisible) return;
      
      try {
        // Estado de la aplicaci√≥n
        const appStatusDiv = document.getElementById('debug-app-status');
        if (appStatusDiv) {
          if (window.StreamGraphicsApp) {
            const status = window.StreamGraphicsApp.getStatus();
            appStatusDiv.innerHTML = `
              <small>
                Inicializada: ${status.isInitialized ? '‚úÖ' : '‚ùå'}<br>
                Uptime: ${Math.round(status.uptime / 1000)}s<br>
                M√≥dulos: ${Object.keys(status.modules).length}
              </small>
            `;
          } else {
            appStatusDiv.innerHTML = '<small style="color: orange;">Cargando...</small>';
          }
        }
        
        // M√≥dulos cargados
        const modulesDiv = document.getElementById('debug-modules');
        if (modulesDiv && window.StreamGraphicsApp) {
          const modules = window.StreamGraphicsApp.modules;
          const moduleList = Object.keys(modules).map(key => {
            const module = modules[key];
            const loaded = !!module;
            return `${key}: ${loaded ? '‚úÖ' : '‚ùå'}`;
          }).join('<br>');
          modulesDiv.innerHTML = `<small>${moduleList}</small>`;
        }
        
        // Scheduler
        const schedulerDiv = document.getElementById('debug-scheduler');
        if (schedulerDiv && window.StreamGraphicsApp?.modules?.scheduler) {
          const scheduler = window.StreamGraphicsApp.modules.scheduler;
          const state = scheduler.getState ? scheduler.getState() : {};
          schedulerDiv.innerHTML = `
            <small>
              Activo: ${state.isActive ? '‚úÖ' : '‚ùå'}<br>
              Ciclos: ${state.stats?.cycles || 0}<br>
              Tareas: ${state.tasksCount || 0}
            </small>
          `;
        }
        
        // Firebase
        const firebaseDiv = document.getElementById('debug-firebase');
        if (firebaseDiv && window.StreamGraphicsApp?.modules?.firebase) {
          const firebase = window.StreamGraphicsApp.modules.firebase;
          const state = firebase.getConnectionState ? firebase.getConnectionState() : {};
          firebaseDiv.innerHTML = `
            <small>
              Conectado: ${state.isConnected ? '‚úÖ' : '‚ùå'}<br>
              Listeners: ${state.activeListeners || 0}<br>
              Auth: ${state.hasAuth ? '‚úÖ' : '‚ùå'}
            </small>
          `;
        }
        
        // Logos
        const logosDiv = document.getElementById('debug-logos');
        if (logosDiv && window.StreamGraphicsApp?.modules?.logoManager) {
          const logoManager = window.StreamGraphicsApp.modules.logoManager;
          const state = logoManager.getState ? logoManager.getState() : {};
          logosDiv.innerHTML = `
            <small>
              Visible: ${state.isVisible ? '‚úÖ' : '‚ùå'}<br>
              Rotaci√≥n: ${state.isRotating ? 'üîÑ' : '‚è∏Ô∏è'}<br>
              √çndice: ${state.currentIndex || 0}
            </small>
          `;
        }
        
      } catch (error) {
        console.warn('‚ö†Ô∏è Error actualizando debug info:', error);
      }
    }
    
    // ===== AUTO-ACTUALIZACI√ìN =====
    
    // Actualizar info cada 3 segundos si el panel est√° visible
    setInterval(() => {
      if (debugVisible) {
        updateDebugInfo();
      }
    }, 3000);
    
    // ===== MANEJO DE EVENTOS DE LA APLICACI√ìN =====
    
    // Escuchar cuando la aplicaci√≥n est√© lista
    document.addEventListener('DOMContentLoaded', () => {
      console.log('üåü DOM listo - Sistema Modular v2.0 inicializando...');
      
      
      // Mostrar panel de debug autom√°ticamente en desarrollo
      const isDevelopment = window.location.hostname === 'localhost' || 
                           window.location.hostname === '127.0.0.1';
      /*
      if (isDevelopment) {
        setTimeout(() => {
          showDebugPanel();
          console.log('üîß Panel de debug mostrado autom√°ticamente (desarrollo)');
        }, 3000);
      }
        */


    });
    
    // Escuchar eventos de la aplicaci√≥n (despu√©s de que se cargue)
    setTimeout(() => {
      if (window.EventBus) {
        window.EventBus.on('app-initialized', () => {
          console.log('üéâ Aplicaci√≥n inicializada correctamente');
          updateDebugInfo();
        });
        
        window.EventBus.on('app-initialization-error', (error) => {
          console.error('üí• Error de inicializaci√≥n:', error);
          const appStatusDiv = document.getElementById('debug-app-status');
          if (appStatusDiv) {
            appStatusDiv.innerHTML = '<small style="color: red;">Error de inicializaci√≥n</small>';
          }
        });
      }
    }, 2000);
    
    // ===== COMPATIBILIDAD CON FUNCIONES ANTERIORES =====
    
    // Mantener algunas funciones del sistema anterior para transici√≥n
    window.testAutomaticSystem = testModularSystem;
    window.logAutomaticStatus = showAppStatus;
    window.clearAllTimers = function() {
      console.log('üîÑ En sistema modular, los temporizadores son manejados por el Scheduler Global');
      if (window.StreamGraphicsApp?.modules?.scheduler) {
        console.log('Estado del scheduler:', window.StreamGraphicsApp.modules.scheduler.getState());
      }
    };
    
    console.log('üîß Sistema de Debug Modular v2.0 cargado');
  </script>
</body>
</html>