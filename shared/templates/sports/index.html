<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gr√°ficos F√∫tbol - Sistema Modular v2.0</title>
  
  <!-- CSS Base del Sistema -->
  <link rel="stylesheet" href="../../css/styles-base.css">
  <link rel="stylesheet" href="../../css/styles-sports.css">
  <link rel="stylesheet" href="../../css/styles-variables.css">
  
  <!-- CSS Personalizado de la Instancia (Se carga din√°micamente) -->
  <!-- <link rel="stylesheet" href="./styles.css"> -->
</head>
<body class="sports-theme football-theme">
  
  <!-- üñºÔ∏è LOGO PRINCIPAL -->
  <img id="logo" src="" alt="Logo" style="display: none;">
  
  <!-- ‚öΩ MARCADOR DEL PARTIDO -->
  <div id="grafico-marcador" class="sports-element animated-element" style="display: none;">
    <div class="marcador-container">
      <div class="equipo-info equipo-local">
        <img class="escudo-equipo" id="escudo-local" src="" alt="Escudo Local">
        <span class="nombre-equipo" id="nombre-local">EQUIPO LOCAL</span>
        <span class="goles-equipo" id="goles-local">0</span>
      </div>
      
      <div class="marcador-centro">
        <div class="tiempo-partido" id="tiempo-partido">45:00</div>
        <div class="estado-partido" id="estado-partido">1T</div>
      </div>
      
      <div class="equipo-info equipo-visitante">
        <span class="goles-equipo" id="goles-visitante">0</span>
        <span class="nombre-equipo" id="nombre-visitante">EQUIPO VISITANTE</span>
        <img class="escudo-equipo" id="escudo-visitante" src="" alt="Escudo Visitante">
      </div>
    </div>
  </div>

  <!-- üë§ JUGADOR DESTACADO -->
  <div id="grafico-jugador" class="sports-element animated-element" style="display: none;">
    <div class="jugador-container">
      <div class="foto-jugador">
        <img id="foto-jugador" src="" alt="Foto Jugador">
        <div class="numero-jugador" id="numero-jugador">10</div>
      </div>
      <div class="info-jugador">
        <h2 class="nombre-jugador" id="nombre-jugador">NOMBRE JUGADOR</h2>
        <div class="detalles-jugador">
          <span class="posicion-jugador" id="posicion-jugador">MED</span>
          <span class="equipo-jugador" id="equipo-jugador">EQUIPO</span>
        </div>
        <div class="stats-jugador">
          <div class="stat-item">
            <span class="stat-label">Goles</span>
            <span class="stat-value" id="goles-jugador">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Tarjetas</span>
            <span class="stat-value" id="tarjetas-jugador">0</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- üìä ESTAD√çSTICAS DEL PARTIDO -->
  <div id="grafico-estadisticas" class="sports-element animated-element" style="display: none;">
    <div class="estadisticas-container">
      <h3 class="titulo-stats">ESTAD√çSTICAS</h3>
      
      <div class="stat-row">
        <span class="stat-local" id="posesion-local">45%</span>
        <span class="stat-label">Posesi√≥n</span>
        <span class="stat-visitante" id="posesion-visitante">55%</span>
      </div>
      
      <div class="stat-row">
        <span class="stat-local" id="tiros-local">3</span>
        <span class="stat-label">Tiros al arco</span>
        <span class="stat-visitante" id="tiros-visitante">5</span>
      </div>
      
      <div class="stat-row">
        <span class="stat-local" id="corners-local">2</span>
        <span class="stat-label">Corners</span>
        <span class="stat-visitante" id="corners-visitante">4</span>
      </div>
      
      <div class="stat-row">
        <span class="stat-local" id="tarjetas-local">1</span>
        <span class="stat-label">Tarjetas</span>
        <span class="stat-visitante" id="tarjetas-visitante">2</span>
      </div>
    </div>
  </div>

  <!-- üèüÔ∏è INFORMACI√ìN DE EQUIPOS (OPCIONAL) -->
  <div id="grafico-equipos" class="sports-element animated-element" style="display: none;">
    <div class="equipos-container">
      <div class="equipo-detalle equipo-local-detail">
        <img class="escudo-grande" id="escudo-local-grande" src="" alt="Escudo Local">
        <h3 id="nombre-local-completo">NOMBRE COMPLETO EQUIPO LOCAL</h3>
        <div class="info-adicional">
          <span id="dt-local">Director T√©cnico</span>
        </div>
      </div>
      
      <div class="vs-separator">VS</div>
      
      <div class="equipo-detalle equipo-visitante-detail">
        <img class="escudo-grande" id="escudo-visitante-grande" src="" alt="Escudo Visitante">
        <h3 id="nombre-visitante-completo">NOMBRE COMPLETO EQUIPO VISITANTE</h3>
        <div class="info-adicional">
          <span id="dt-visitante">Director T√©cnico</span>
        </div>
      </div>
    </div>
    
    <!-- Informaci√≥n del evento -->
    <div class="evento-info">
      <div class="torneo" id="nombre-torneo">LIGA PRO</div>
      <div class="fecha-estadio">
        <span id="fecha-partido">15 DIC 2024</span>
        <span class="separador">|</span>
        <span id="estadio-partido">Estadio Monumental</span>
      </div>
    </div>
  </div>

  <!-- üïê RELOJ DEL STREAM -->
  <div id="stream-clock" class="clock-element" style="display: none;">
    00:00
  </div>

  <!-- üìä ESTADO DE CONEXI√ìN -->
  <div id="status" class="status-element sports-status">
    <span id="connection-status">Conectando...</span>
    <span id="instance-info">F√∫tbol</span>
  </div>

  <!-- üîß PANEL DE DEBUG (Solo si est√° habilitado) -->
  <div id="debug-panel" class="debug-panel sports-debug" style="display: none;">
    <div class="debug-header">
      <h4>üîß Debug - F√∫tbol</h4>
      <button id="toggle-debug" onclick="toggleDebugPanel()">‚ùå</button>
    </div>
    <div class="debug-content">
      <div class="debug-section">
        <h5>üìä Estado Instancia:</h5>
        <div id="debug-instance-status">Cargando...</div>
      </div>
      <div class="debug-section">
        <h5>üî• Firebase:</h5>
        <div id="debug-firebase-status">Desconectado</div>
      </div>
      <div class="debug-section">
        <h5>‚öΩ Elementos:</h5>
        <div id="debug-elements-status">
          <div>Logo: <span id="logo-status">‚ùå</span></div>
          <div>Marcador: <span id="marcador-status">‚ùå</span></div>
          <div>Jugador: <span id="jugador-status">‚ùå</span></div>
          <div>Estad√≠sticas: <span id="estadisticas-status">‚ùå</span></div>
        </div>
      </div>
      <div class="debug-section">
        <h5>üèüÔ∏è Datos del Partido:</h5>
        <div id="debug-match-data">Sin datos</div>
      </div>
    </div>
    <div class="debug-controls">
      <button onclick="testSportsElements()">üß™ Test Elementos</button>
      <button onclick="showMatchStatus()">‚öΩ Estado Partido</button>
      <button onclick="simulateMatchData()">üèüÔ∏è Simular Partido</button>
      <button onclick="clearConsole()">üóëÔ∏è Limpiar</button>
    </div>
  </div>

  <!-- üöÄ SISTEMA MODULAR - CARGA PRINCIPAL -->
  <script type="module">
    // Importar configuraci√≥n espec√≠fica de esta instancia
    import { instanceConfig } from './config.js';
    
    // Importar motor principal
    import { StreamGraphicsApp } from '../../js/main-template.js';
    
    // üéØ INICIALIZACI√ìN ESPEC√çFICA DE F√öTBOL
    console.log('‚öΩ Inicializando instancia de F√öTBOL...');
    console.log('‚öôÔ∏è Configuraci√≥n:', instanceConfig);
    
    // Crear y inicializar aplicaci√≥n
    const app = new StreamGraphicsApp(instanceConfig);
    
    // Hacer disponible globalmente para debug
    window.SportsApp = app;
    window.instanceConfig = instanceConfig;
    
    // Inicializar cuando el DOM est√© listo
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        await app.init();
        
        // Actualizar informaci√≥n de estado
        updateConnectionStatus('‚úÖ Conectado', 'success');
        updateInstanceInfo(`‚öΩ ${instanceConfig.instanceName}`);
        
        console.log('‚úÖ Instancia de f√∫tbol iniciada correctamente');
        
      } catch (error) {
        console.error('üí• Error inicializando instancia de f√∫tbol:', error);
        updateConnectionStatus('‚ùå Error', 'error');
        
        // Mostrar error en pantalla
        showErrorMessage(error.message);
      }
    });
    
    // üîß FUNCIONES DE UTILIDAD PARA F√öTBOL
    function updateConnectionStatus(status, type) {
      const statusElement = document.getElementById('connection-status');
      if (statusElement) {
        statusElement.textContent = status;
        statusElement.className = `status-${type}`;
      }
    }
    
    function updateInstanceInfo(info) {
      const infoElement = document.getElementById('instance-info');
      if (infoElement) {
        infoElement.textContent = info;
      }
    }
    
    function showErrorMessage(message) {
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error-message sports-error';
      errorDiv.innerHTML = `
        <h3>‚ùå Error de Inicializaci√≥n</h3>
        <p><strong>Instancia:</strong> F√∫tbol</p>
        <p><strong>Error:</strong> ${message}</p>
        <button onclick="location.reload()" class="retry-button">üîÑ Reintentar</button>
      `;
      document.body.appendChild(errorDiv);
    }
  </script>
  
  <!-- üîß FUNCIONES DE DEBUG PARA F√öTBOL -->
  <script>
    let debugVisible = false;
    
    // ===== FUNCIONES DE DEBUG ESPEC√çFICAS DE F√öTBOL =====
    
    function toggleDebugPanel() {
      const panel = document.getElementById('debug-panel');
      if (panel) {
        debugVisible = !debugVisible;
        panel.style.display = debugVisible ? 'block' : 'none';
        if (debugVisible) {
          updateDebugInfo();
        }
      }
    }
    
    function testSportsElements() {
      console.log('üß™ Testing elementos de f√∫tbol...');
      
      if (window.SportsApp && window.SportsApp.modules) {
        const app = window.SportsApp;
        
        // Test secuencial de elementos deportivos
        setTimeout(() => {
          console.log('‚öΩ Mostrando marcador...');
          app.showElement('marcador', {
            equipoLocal: 'Barcelona SC',
            equipoVisitante: 'Emelec',
            golesLocal: 2,
            golesVisitante: 1,
            tiempo: '67:30',
            estado: '2T'
          });
        }, 1000);
        
        setTimeout(() => {
          console.log('üë§ Mostrando jugador...');
          app.showElement('jugador', {
            nombre: 'Carlos Garc√©s',
            posicion: 'DEL',
            equipo: 'Barcelona SC',
            numero: 9
          });
        }, 3000);
        
        setTimeout(() => {
          console.log('üìä Mostrando estad√≠sticas...');
          app.showElement('estadisticas');
        }, 5000);
        
        setTimeout(() => {
          console.log('üñºÔ∏è Mostrando logo...');
          if (app.modules.logoManager) {
            app.modules.logoManager.show();
          }
        }, 7000);
        
        setTimeout(() => {
          console.log('üîÑ Ocultando todo...');
          app.hideElement('marcador');
          app.hideElement('jugador');
          app.hideElement('estadisticas');
          if (app.modules.logoManager) {
            app.modules.logoManager.hide();
          }
        }, 10000);
        
      } else {
        console.error('‚ùå App de f√∫tbol no disponible');
      }
    }
    
    function showMatchStatus() {
      console.log('‚öΩ ESTADO DEL PARTIDO:');
      
      if (window.SportsApp) {
        const status = window.SportsApp.getStatus();
        console.table(status);
        console.log('Firebase Path:', status.firebasePath);
        console.log('Deporte:', status.sport || 'futbol');
      }
      
      if (window.lastFirebaseData) {
        console.log('Datos del partido:', {
          equipoLocal: window.lastFirebaseData.Equipo_Local,
          equipoVisitante: window.lastFirebaseData.Equipo_Visitante,
          golesLocal: window.lastFirebaseData.Goles_Local,
          golesVisitante: window.lastFirebaseData.Goles_Visitante,
          tiempo: window.lastFirebaseData.Tiempo_Partido,
          estado: window.lastFirebaseData.Estado_Partido
        });
      }
    }
    
    function simulateMatchData() {
      console.log('‚öΩ Simulando datos de partido...');
      
      const sampleMatchData = {
        // Visibilidad
        logoAlAire: true,
        marcadorAlAire: true,
        jugadorAlAire: false,
        estadisticasAlAire: false,
        
        // Datos del partido
        Equipo_Local: "Barcelona SC",
        Equipo_Visitante: "Emelec",
        Goles_Local: 2,
        Goles_Visitante: 1,
        Tiempo_Partido: "67:30",
        Minuto_Partido: 67,
        Estado_Partido: "SEGUNDO_TIEMPO",
        
        // Jugador destacado
        Jugador_Destacado: "Carlos Garc√©s",
        Posicion_Jugador: "DEL",
        Equipo_Jugador: "Barcelona SC",
        Numero_Jugador: 9,
        
        // URLs de prueba
        urlLogo_Local: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiPjxyZWN0IHdpZHRoPSI1MCIgaGVpZ2h0PSI1MCIgZmlsbD0iI0ZGRDcwMCIvPjx0ZXh0IHg9IjI1IiB5PSIzMCIgZmlsbD0iYmxhY2siIHRleHQtYW5jaG9yPSJtaWRkbGUiPkJTQzwvdGV4dD48L3N2Zz4=",
        urlLogo_Visitante: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiPjxyZWN0IHdpZHRoPSI1MCIgaGVpZ2h0PSI1MCIgZmlsbD0iIzAwNjZDQyIvPjx0ZXh0IHg9IjI1IiB5PSIzMCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkVNRTwvdGV4dD48L3N2Zz4=",
        
        // Colores
        colorEquipo_Local: "#FFD700",
        colorEquipo_Visitante: "#0066CC",
        colorFondo_Marcador: "#000000",
        colorTexto_Marcador: "#FFFFFF",
        
        // Estad√≠sticas
        Posesion_Local: 65,
        Posesion_Visitante: 35,
        Tiros_Local: 8,
        Tiros_Visitante: 4,
        Corners_Local: 5,
        Corners_Visitante: 2,
        
        // Configuraci√≥n
        modoAutomatico: false,
        category: 'futbol'
      };
      
      if (window.SportsApp) {
        window.SportsApp.applyDataChanges(sampleMatchData);
        console.log('‚úÖ Datos de partido de prueba aplicados');
        
        // Actualizar elementos DOM manualmente para demo
        updateMatchElements(sampleMatchData);
      }
    }
    
    function updateMatchElements(data) {
      // Actualizar marcador
      const nombreLocal = document.getElementById('nombre-local');
      const nombreVisitante = document.getElementById('nombre-visitante');
      const golesLocal = document.getElementById('goles-local');
      const golesVisitante = document.getElementById('goles-visitante');
      const tiempoPartido = document.getElementById('tiempo-partido');
      const estadoPartido = document.getElementById('estado-partido');
      
      if (nombreLocal) nombreLocal.textContent = data.Equipo_Local;
      if (nombreVisitante) nombreVisitante.textContent = data.Equipo_Visitante;
      if (golesLocal) golesLocal.textContent = data.Goles_Local;
      if (golesVisitante) golesVisitante.textContent = data.Goles_Visitante;
      if (tiempoPartido) tiempoPartido.textContent = data.Tiempo_Partido;
      if (estadoPartido) estadoPartido.textContent = data.Estado_Partido === 'SEGUNDO_TIEMPO' ? '2T' : '1T';
      
      // Actualizar escudos
      const escudoLocal = document.getElementById('escudo-local');
      const escudoVisitante = document.getElementById('escudo-visitante');
      
      if (escudoLocal && data.urlLogo_Local) escudoLocal.src = data.urlLogo_Local;
      if (escudoVisitante && data.urlLogo_Visitante) escudoVisitante.src = data.urlLogo_Visitante;
      
      // Actualizar jugador
      const nombreJugador = document.getElementById('nombre-jugador');
      const posicionJugador = document.getElementById('posicion-jugador');
      const equipoJugador = document.getElementById('equipo-jugador');
      const numeroJugador = document.getElementById('numero-jugador');
      
      if (nombreJugador) nombreJugador.textContent = data.Jugador_Destacado;
      if (posicionJugador) posicionJugador.textContent = data.Posicion_Jugador;
      if (equipoJugador) equipoJugador.textContent = data.Equipo_Jugador;
      if (numeroJugador) numeroJugador.textContent = data.Numero_Jugador;
      
      // Actualizar estad√≠sticas
      const posesionLocal = document.getElementById('posesion-local');
      const posesionVisitante = document.getElementById('posesion-visitante');
      const tirosLocal = document.getElementById('tiros-local');
      const tirosVisitante = document.getElementById('tiros-visitante');
      const cornersLocal = document.getElementById('corners-local');
      const cornersVisitante = document.getElementById('corners-visitante');
      
      if (posesionLocal) posesionLocal.textContent = data.Posesion_Local + '%';
      if (posesionVisitante) posesionVisitante.textContent = data.Posesion_Visitante + '%';
      if (tirosLocal) tirosLocal.textContent = data.Tiros_Local;
      if (tirosVisitante) tirosVisitante.textContent = data.Tiros_Visitante;
      if (cornersLocal) cornersLocal.textContent = data.Corners_Local;
      if (cornersVisitante) cornersVisitante.textContent = data.Corners_Visitante;
    }
    
    function updateDebugInfo() {
      if (!debugVisible) return;
      
      // Actualizar estado de la instancia
      const instanceStatusDiv = document.getElementById('debug-instance-status');
      if (instanceStatusDiv && window.SportsApp) {
        const status = window.SportsApp.getStatus();
        instanceStatusDiv.innerHTML = `
          <small>
            ID: ${status.instanceId}<br>
            Categor√≠a: ${status.category}<br>
            Deporte: ${status.sport || 'futbol'}<br>
            Inicializada: ${status.isInitialized ? '‚úÖ' : '‚ùå'}<br>
            Tiempo Init: ${status.initTime?.toFixed(0) || 0}ms
          </small>
        `;
      }
      
      // Actualizar estado Firebase
      const firebaseStatusDiv = document.getElementById('debug-firebase-status');
      if (firebaseStatusDiv && window.SportsApp?.modules?.firebaseClient) {
        const fbState = window.SportsApp.modules.firebaseClient.getConnectionState();
        firebaseStatusDiv.innerHTML = `
          <small>
            Conectado: ${fbState.isConnected ? '‚úÖ' : '‚ùå'}<br>
            Path: ${window.instanceConfig?.firebasePath}<br>
            Listeners: ${fbState.activeListeners || 0}
          </small>
        `;
      }
      
      // Actualizar datos del partido
      const matchDataDiv = document.getElementById('debug-match-data');
      if (matchDataDiv && window.lastFirebaseData) {
        const data = window.lastFirebaseData;
        matchDataDiv.innerHTML = `
          <small>
            ${data.Equipo_Local || 'Local'} ${data.Goles_Local || 0} - ${data.Goles_Visitante || 0} ${data.Equipo_Visitante || 'Visitante'}<br>
            Tiempo: ${data.Tiempo_Partido || '00:00'}<br>
            Estado: ${data.Estado_Partido || 'PROXIMO'}<br>
            Jugador: ${data.Jugador_Destacado || 'N/A'}
          </small>
        `;
      }
      
      // Actualizar estado de elementos
      updateElementStatus('logo', 'logo-status');
      updateElementStatus('grafico-marcador', 'marcador-status');
      updateElementStatus('grafico-jugador', 'jugador-status');
      updateElementStatus('grafico-estadisticas', 'estadisticas-status');
    }
    
    function updateElementStatus(elementId, statusId) {
      const element = document.getElementById(elementId);
      const statusSpan = document.getElementById(statusId);
      
      if (element && statusSpan) {
        const isVisible = element.style.display !== 'none';
        statusSpan.textContent = isVisible ? '‚úÖ' : '‚ùå';
        statusSpan.className = isVisible ? 'status-visible' : 'status-hidden';
      }
    }
    
    function clearConsole() {
      console.clear();
      console.log('üóëÔ∏è Console limpiada - Instancia de F√∫tbol');
      console.log('üí° Comandos disponibles:');
      console.log('  - testSportsElements(): Probar elementos');
      console.log('  - showMatchStatus(): Ver estado del partido');
      console.log('  - simulateMatchData(): Simular partido');
    }
    
    // ===== AUTO-ACTUALIZACI√ìN DEBUG =====
    setInterval(() => {
      if (debugVisible) {
        updateDebugInfo();
      }
    }, 3000);
    
    // ===== ATAJOS DE TECLADO PARA DEBUG =====
    document.addEventListener('keydown', (e) => {
      // Ctrl + D = Toggle Debug
      if (e.ctrlKey && e.key === 'd') {
        e.preventDefault();
        toggleDebugPanel();
      }
      
      // Ctrl + T = Test Elements
      if (e.ctrlKey && e.key === 't') {
        e.preventDefault();
        testSportsElements();
      }
      
      // Ctrl + M = Simulate Match
      if (e.ctrlKey && e.key === 'm') {
        e.preventDefault();
        simulateMatchData();
      }
    });
    
    console.log('‚öΩ Sports Template HTML loaded');
    console.log('üí° Debug: Ctrl+D | Test: Ctrl+T | Match: Ctrl+M');
  </script>
</body>
</html>