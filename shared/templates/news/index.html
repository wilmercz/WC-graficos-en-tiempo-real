<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gr√°ficos Noticias - Sistema Modular v2.0</title>
  
  <!-- CSS Base del Sistema -->
  <link rel="stylesheet" href="../../css/styles-base.css">
  <link rel="stylesheet" href="../../css/styles-news.css">
  <link rel="stylesheet" href="../../css/styles-variables.css">
  
  <!-- CSS Personalizado de la Instancia (Se carga din√°micamente) -->
  <!-- <link rel="stylesheet" href="./styles.css"> -->
</head>
<body class="news-theme">
  
  <!-- üñºÔ∏è LOGO PRINCIPAL -->
  <img id="logo" src="" alt="Logo" style="display: none;">
  
  <!-- üì∫ GR√ÅFICO INVITADO/ROL -->
  <div id="grafico-invitado-rol" class="news-element animated-element" style="display: none;">
    <h1 id="invitado">INVITADO</h1>
    <h2 id="rol">ROL</h2>
  </div>
  
  <!-- üìã GR√ÅFICO TEMA -->
  <div id="grafico-tema" class="news-element animated-element" style="display: none;">
    <h1 id="tema">TEMA</h1>
    <!-- C√≠rculo decorativo para tema -->
    <h2 class="tema-circle"></h2>
  </div>

  <!-- üì∫ GR√ÅFICO PUBLICIDAD -->
  <div id="grafico-publicidad" class="news-element animated-element" style="display: none;">
    <img id="publicidad-img" src="" alt="Publicidad">
  </div>

  <!-- üïê RELOJ DEL STREAM -->
  <div id="stream-clock" class="clock-element" style="display: none;">
    00:00
  </div>

  <!-- üìä ESTADO DE CONEXI√ìN -->
  <div id="status" class="status-element">
    <span id="connection-status">Conectando...</span>
    <span id="instance-info">Noticias</span>
  </div>

  <!-- üîß PANEL DE DEBUG (Solo si est√° habilitado) -->
  <div id="debug-panel" class="debug-panel news-debug" style="display: none;">
    <div class="debug-header">
      <h4>üîß Debug - Noticias</h4>
      <button id="toggle-debug" onclick="toggleDebugPanel()">‚ùå</button>
    </div>
    <div class="debug-content">
      <div class="debug-section">
        <h5>üìä Estado Instancia:</h5>
        <div id="debug-instance-status">Cargando...</div>
      </div>
      <div class="debug-section">
        <h5>üî• Firebase:</h5>
        <div id="debug-firebase-status">Desconectado</div>
      </div>
      <div class="debug-section">
        <h5>üì∫ Elementos:</h5>
        <div id="debug-elements-status">
          <div>Logo: <span id="logo-status">‚ùå</span></div>
          <div>Invitado: <span id="invitado-status">‚ùå</span></div>
          <div>Tema: <span id="tema-status">‚ùå</span></div>
          <div>Publicidad: <span id="publicidad-status">‚ùå</span></div>
        </div>
      </div>
    </div>
    <div class="debug-controls">
      <button onclick="testNewsElements()">üß™ Test Elementos</button>
      <button onclick="showInstanceStatus()">üìä Estado</button>
      <button onclick="simulateNewsData()">üì∫ Simular Datos</button>
      <button onclick="clearConsole()">üóëÔ∏è Limpiar</button>
    </div>
  </div>

  <!-- üöÄ SISTEMA MODULAR - CARGA PRINCIPAL -->
  <script type="module">
    // Importar configuraci√≥n espec√≠fica de esta instancia
    import { instanceConfig } from './config.js';
    
    // Importar motor principal
    import { StreamGraphicsApp } from '../../js/main-template.js';
    
    // üéØ INICIALIZACI√ìN ESPEC√çFICA DE NOTICIAS
    console.log('üì∫ Inicializando instancia de NOTICIAS...');
    console.log('‚öôÔ∏è Configuraci√≥n:', instanceConfig);
    
    // Crear y inicializar aplicaci√≥n
    const app = new StreamGraphicsApp(instanceConfig);
    
    // Hacer disponible globalmente para debug
    window.NewsApp = app;
    window.instanceConfig = instanceConfig;
    
    // Inicializar cuando el DOM est√© listo
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        await app.init();
        
        // Actualizar informaci√≥n de estado
        updateConnectionStatus('‚úÖ Conectado', 'success');
        updateInstanceInfo(`üì∫ ${instanceConfig.instanceName}`);
        
        console.log('‚úÖ Instancia de noticias iniciada correctamente');
        
      } catch (error) {
        console.error('üí• Error inicializando instancia de noticias:', error);
        updateConnectionStatus('‚ùå Error', 'error');
        
        // Mostrar error en pantalla
        showErrorMessage(error.message);
      }
    });
    
    // üîß FUNCIONES DE UTILIDAD PARA NOTICIAS
    function updateConnectionStatus(status, type) {
      const statusElement = document.getElementById('connection-status');
      if (statusElement) {
        statusElement.textContent = status;
        statusElement.className = `status-${type}`;
      }
    }
    
    function updateInstanceInfo(info) {
      const infoElement = document.getElementById('instance-info');
      if (infoElement) {
        infoElement.textContent = info;
      }
    }
    
    function showErrorMessage(message) {
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error-message news-error';
      errorDiv.innerHTML = `
        <h3>‚ùå Error de Inicializaci√≥n</h3>
        <p><strong>Instancia:</strong> Noticias</p>
        <p><strong>Error:</strong> ${message}</p>
        <button onclick="location.reload()" class="retry-button">üîÑ Reintentar</button>
      `;
      document.body.appendChild(errorDiv);
    }
  </script>
  
  <!-- üîß FUNCIONES DE DEBUG PARA NOTICIAS -->
  <script>
    let debugVisible = false;
    
    // ===== FUNCIONES DE DEBUG ESPEC√çFICAS DE NOTICIAS =====
    
    function toggleDebugPanel() {
      const panel = document.getElementById('debug-panel');
      if (panel) {
        debugVisible = !debugVisible;
        panel.style.display = debugVisible ? 'block' : 'none';
        if (debugVisible) {
          updateDebugInfo();
        }
      }
    }
    
    function testNewsElements() {
      console.log('üß™ Testing elementos de noticias...');
      
      if (window.NewsApp && window.NewsApp.modules) {
        const app = window.NewsApp;
        
        // Test secuencial de elementos
        setTimeout(() => {
          console.log('üì∫ Mostrando invitado...');
          app.showElement('invitado', {
            invitado: 'TEST INVITADO',
            rol: 'TEST ROL'
          });
        }, 1000);
        
        setTimeout(() => {
          console.log('üìã Mostrando tema...');
          app.showElement('tema', {
            tema: 'TEST TEMA DE NOTICIAS'
          });
        }, 3000);
        
        setTimeout(() => {
          console.log('üñºÔ∏è Mostrando logo...');
          if (app.modules.logoManager) {
            app.modules.logoManager.show();
          }
        }, 5000);
        
        setTimeout(() => {
          console.log('üîÑ Ocultando todo...');
          app.hideElement('invitado');
          app.hideElement('tema');
          if (app.modules.logoManager) {
            app.modules.logoManager.hide();
          }
        }, 8000);
        
      } else {
        console.error('‚ùå App de noticias no disponible');
      }
    }
    
    function showInstanceStatus() {
      console.log('üìä ESTADO DE INSTANCIA DE NOTICIAS:');
      
      if (window.NewsApp) {
        const status = window.NewsApp.getStatus();
        console.table(status);
        console.log('Firebase Path:', status.firebasePath);
        console.log('Categor√≠a:', status.category);
      }
      
      if (window.instanceConfig) {
        console.log('Configuraci√≥n:', window.instanceConfig);
      }
    }
    
    function simulateNewsData() {
      console.log('üì∫ Simulando datos de noticias...');
      
      const sampleData = {
        logoAlAire: true,
        graficoAlAire: true,
        temaAlAire: false,
        publicidadAlAire: false,
        
        Invitado: "Dr. Mar√≠a Gonz√°lez",
        Rol: "Ministra de Salud",
        Tema: "Nuevas medidas sanitarias",
        
        urlLogo: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiPjxyZWN0IHdpZHRoPSI1MCIgaGVpZ2h0PSI1MCIgZmlsbD0iIzAwNjZjYyIvPjx0ZXh0IHg9IjI1IiB5PSIzMCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkxPR088L3RleHQ+PC9zdmc+",
        
        colorFondo1: "#1066DC",
        colorLetra1: "#FFFFFF",
        colorFondo2: "#1066FF", 
        colorLetra2: "#FFFFFF",
        
        modoAutomatico: false
      };
      
      if (window.NewsApp) {
        window.NewsApp.applyDataChanges(sampleData);
        console.log('‚úÖ Datos de prueba aplicados');
      }
    }
    
    function updateDebugInfo() {
      if (!debugVisible) return;
      
      // Actualizar estado de la instancia
      const instanceStatusDiv = document.getElementById('debug-instance-status');
      if (instanceStatusDiv && window.NewsApp) {
        const status = window.NewsApp.getStatus();
        instanceStatusDiv.innerHTML = `
          <small>
            ID: ${status.instanceId}<br>
            Categor√≠a: ${status.category}<br>
            Inicializada: ${status.isInitialized ? '‚úÖ' : '‚ùå'}<br>
            Tiempo Init: ${status.initTime?.toFixed(0) || 0}ms
          </small>
        `;
      }
      
      // Actualizar estado Firebase
      const firebaseStatusDiv = document.getElementById('debug-firebase-status');
      if (firebaseStatusDiv && window.NewsApp?.modules?.firebaseClient) {
        const fbState = window.NewsApp.modules.firebaseClient.getConnectionState();
        firebaseStatusDiv.innerHTML = `
          <small>
            Conectado: ${fbState.isConnected ? '‚úÖ' : '‚ùå'}<br>
            Path: ${window.instanceConfig?.firebasePath}<br>
            Listeners: ${fbState.activeListeners || 0}
          </small>
        `;
      }
      
      // Actualizar estado de elementos
      updateElementStatus('logo', 'logo-status');
      updateElementStatus('grafico-invitado-rol', 'invitado-status');
      updateElementStatus('grafico-tema', 'tema-status');
      updateElementStatus('grafico-publicidad', 'publicidad-status');
    }
    
    function updateElementStatus(elementId, statusId) {
      const element = document.getElementById(elementId);
      const statusSpan = document.getElementById(statusId);
      
      if (element && statusSpan) {
        const isVisible = element.style.display !== 'none';
        statusSpan.textContent = isVisible ? '‚úÖ' : '‚ùå';
        statusSpan.className = isVisible ? 'status-visible' : 'status-hidden';
      }
    }
    
    function clearConsole() {
      console.clear();
      console.log('üóëÔ∏è Console limpiada - Instancia de Noticias');
      console.log('üí° Comandos disponibles:');
      console.log('  - testNewsElements(): Probar elementos');
      console.log('  - showInstanceStatus(): Ver estado');
      console.log('  - simulateNewsData(): Simular datos');
    }
    
    // ===== AUTO-ACTUALIZACI√ìN DEBUG =====
    setInterval(() => {
      if (debugVisible) {
        updateDebugInfo();
      }
    }, 2000);
    
    // ===== ATAJOS DE TECLADO PARA DEBUG =====
    document.addEventListener('keydown', (e) => {
      // Ctrl + D = Toggle Debug
      if (e.ctrlKey && e.key === 'd') {
        e.preventDefault();
        toggleDebugPanel();
      }
      
      // Ctrl + T = Test Elements
      if (e.ctrlKey && e.key === 't') {
        e.preventDefault();
        testNewsElements();
      }
    });
    
    console.log('üì∫ News Template HTML loaded');
    console.log('üí° Debug: Ctrl+D | Test: Ctrl+T');
  </script>
</body>
</html>